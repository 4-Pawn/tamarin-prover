theory N4DiffTest
begin

/*
 * Protocol:	 Test whether condition N4 is treated correctly
 * Modeler: 	 Jannik Dreier and Ralf Sasse
 * Described in: 
 * Date: 	 April 2014
 *
 * Status: 	 ?
 */


builtins: diffie-hellman


// Registering a public key
rule Test:
  [ Fr(~f), In(x) ]
  --[ Prod(x) ]->
  [ Out(diff(x,~f)) ]

axiom Product:
  "
  All x #i. Prod(x) @ i ==> (Ex a b. x = (a*b))
  "

// This lemma uses an automatically generated Fact "DiffIntrEquality"
// which the parser does not know about, and thus complains, which can be
// safely ignored.
lemma Diff_test:
  all-traces
  "
  not( Ex #i. DiffIntrEquality() @ i)
  "

//This MUST find an attack, otherwise condition N4 is still used and cases are probably missed!
  
end
